<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>CityBeat — Events</title>
  <link rel="stylesheet" href="/header/header.css">
  <link rel="stylesheet" href="/footer/footer.css">
  <link rel="stylesheet" href="events.css">
</head>
<body>
  <div id="site-header"></div>

  <main class="events-main">
    <section class="events-panel">
      <h1>Events</h1>
      <p class="lead">Discover exciting events happening in your city.</p>

      <div class="controls">
        <div class="filters">
          <label>Category
            <select id="filter-category">
              <option value="">All categories</option>
            </select>
          </label>

          <label>Date
            <select id="filter-date">
              <option value="all">All dates</option>
              <option value="today">Today</option>
              <option value="next7">Next 7 days</option>
            </select>
          </label>

          <label>Sort
            <select id="filter-sort">
              <option value="date_asc">Date ↑</option>
              <option value="date_desc">Date ↓</option>
              <option value="alpha_asc">Title A→Z</option>
              <option value="alpha_desc">Title Z→A</option>
            </select>
          </label>
        </div>
      </div>

      <div id="events-list" class="events-list">
        <!-- events rendered here -->
      </div>

      <div class="pager" id="pager"></div>
    </section>
  </main>

  <div id="site-footer"></div>

  <script>
    // inject header/footer and init header UI. When injecting HTML via innerHTML, inline scripts don't execute
    // automatically, so we re-create and append any script tags to run the header script.
    fetch('/header/header.html').then(r=>r.text()).then(html=>{
      const headerContainer = document.getElementById('site-header');
      headerContainer.innerHTML = html;

      // find any scripts inside the injected header and evaluate them by creating new script elements
      const scripts = headerContainer.querySelectorAll('script');
      scripts.forEach(s => {
        try{
          const ns = document.createElement('script');
          if(s.src){ ns.src = s.src; ns.async = false; document.head.appendChild(ns); }
          else { ns.textContent = s.textContent; document.head.appendChild(ns); }
        }catch(e){ console.warn('failed to eval header script', e); }
        // remove original to avoid double-run if innerHTML is re-applied
        s.parentNode && s.parentNode.removeChild(s);
      });

      const explore = document.querySelector('.explore-create'); if(explore) explore.style.display = 'none';
      const search = document.querySelector('.search-group'); if(search) search.style.display = 'flex';
      const userBtns = document.querySelector('.user-buttons'); if(userBtns) userBtns.style.display = 'flex';
      const auth = document.querySelector('.auth-buttons'); if(auth) auth.style.display = 'none';

      // small header init: ensure profile dropdown exists (notifications are handled centrally in header)
      (function(){
        if(!document.querySelector('.profile-dropdown')){
          const div = document.createElement('div'); div.className='profile-dropdown'; div.innerHTML='<div class="pd-inner"><div class="pd-header"><img src="https://randomuser.me/api/portraits/men/75.jpg"><div><div class="pd-name">Milo James</div><div style="font-size:12px;color:#666">milo.james@example.com</div></div></div><div class="pd-sep"></div><ul class="pd-list"><li data-action="profile">Profile</li><li data-action="dashboard">Dashboard</li><li data-action="settings">Settings</li><li data-action="feedback">Give us feedback</li><li data-action="logout">Logout</li></ul></div>';
          document.body.appendChild(div);
        }
      })();

    }).catch(e=>console.warn('Header load failed',e));
    fetch('/footer/footer.html').then(r=>r.text()).then(html=>document.getElementById('site-footer').innerHTML = html).catch(()=>{});
  </script>

  <script src="events.api.js"></script>
</body>
</html>
